<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>DiNGo â€” Live Multiplayer Bingo</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <style>

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESIGN TOKENS â€” Dark (default) + Light
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --bg:       #07090f;
      --surf:     #0d1220;
      --surf2:    #131927;
      --border:   rgba(255,255,255,0.07);
      --cyan:     #00e5ff;
      --pink:     #ff3cac;
      --gold:     #ffd166;
      --green:    #06ffa5;
      --text:     #dde6f0;
      --muted:    #4e5f78;
      --radius:   14px;
      --glow-c:   0 0 28px rgba(0,229,255,0.4);
      --glow-p:   0 0 28px rgba(255,60,172,0.4);
      --win-glow: 0 0 22px rgba(255,209,102,0.7);
      --theme-icon: "ğŸŒ™";
    }

    /* â”€â”€ LIGHT THEME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    body.light {
      --bg:     #f0f4ff;
      --surf:   #ffffff;
      --surf2:  #eef2fc;
      --border: rgba(0,0,0,0.09);
      --text:   #0f1c35;
      --muted:  #8494b0;
      --glow-c: 0 0 18px rgba(0,150,200,0.25);
      --glow-p: 0 0 18px rgba(200,30,120,0.2);
      --theme-icon: "â˜€ï¸";
    }
    body.light .bg-mesh::before {
      background:
        radial-gradient(ellipse 55% 45% at 15% 25%, rgba(0,180,220,0.07) 0%, transparent 55%),
        radial-gradient(ellipse 45% 55% at 85% 75%, rgba(220,50,150,0.05) 0%, transparent 55%);
    }
    body.light .bg-mesh::after {
      background-image: radial-gradient(circle, rgba(0,0,0,0.04) 1px, transparent 1px);
    }
    body.light input[type="text"] {
      background: rgba(0,0,0,0.04);
      color: var(--text);
    }
    body.light .btn-ghost {
      background: rgba(0,0,0,0.05);
      color: var(--text);
    }
    body.light .chat-panel,
    body.light .card {
      box-shadow: 0 20px 60px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.8);
    }
    body.light #win-overlay { background: rgba(240,244,255,0.92); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESET
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width: 100%; height: 100%; overflow: hidden; }
    body {
      font-family: 'Syne', sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background .4s, color .4s;
    }

    /* Animated background mesh */
    .bg-mesh {
      position: fixed; inset: 0; z-index: 0;
      pointer-events: none; overflow: hidden;
    }
    .bg-mesh::before {
      content: '';
      position: absolute; inset: -60%;
      width: 220%; height: 220%;
      background:
        radial-gradient(ellipse 55% 45% at 15% 25%, rgba(0,229,255,0.09) 0%, transparent 55%),
        radial-gradient(ellipse 45% 55% at 85% 75%, rgba(255,60,172,0.08) 0%, transparent 55%),
        radial-gradient(ellipse 35% 35% at 55% 50%, rgba(6,255,165,0.04) 0%, transparent 65%);
      animation: meshDrift 20s ease-in-out infinite alternate;
      transition: background .4s;
    }
    .bg-mesh::after {
      content: '';
      position: absolute; inset: 0;
      background-image: radial-gradient(circle, rgba(255,255,255,0.028) 1px, transparent 1px);
      background-size: 34px 34px;
      transition: background .4s;
    }
    @keyframes meshDrift {
      from { transform: translate(0,0) rotate(0deg); }
      to   { transform: translate(4%,3%) rotate(4deg); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       THEME TOGGLE BUTTON (top-right, fixed)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #theme-toggle {
      position: fixed;
      top: 16px; right: 16px;
      z-index: 500;
      width: 40px; height: 40px;
      border-radius: 50%;
      background: var(--surf2);
      border: 1px solid var(--border);
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
      transition: background .3s, border-color .3s, transform .2s, box-shadow .2s;
      box-shadow: 0 2px 12px rgba(0,0,0,0.3);
    }
    #theme-toggle:hover {
      transform: scale(1.1) rotate(20deg);
      border-color: var(--cyan);
      box-shadow: 0 4px 20px rgba(0,229,255,0.3);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SCREEN SYSTEM
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .screen {
      position: fixed; inset: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 16px;
      opacity: 0; pointer-events: none;
      transform: translateY(20px) scale(0.97);
      transition: opacity .45s cubic-bezier(.4,0,.2,1), transform .45s cubic-bezier(.4,0,.2,1);
      z-index: 10;
    }
    .screen.active {
      opacity: 1; pointer-events: all;
      transform: translateY(0) scale(1);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CARD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .card {
      background: var(--surf);
      border: 1px solid var(--border);
      border-radius: 24px;
      width: 100%; max-width: 440px;
      position: relative; overflow: hidden;
      box-shadow: 0 40px 100px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.06);
      transition: background .4s, border-color .4s, box-shadow .4s;
    }
    .card::before {
      content: ''; position: absolute;
      top: 0; left: 0; right: 0; height: 2px;
      background: linear-gradient(90deg, var(--cyan), var(--pink));
    }
    .card-body {
      padding: 36px 36px 32px;
      overflow-y: auto;
      max-height: calc(100vh - 48px);
      scrollbar-width: none;
    }
    .card-body::-webkit-scrollbar { display: none; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       â‘  SPLASH / WELCOME SCREEN
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #splash-screen { background: var(--bg); }
    #splash-screen .card {
      max-width: 480px; text-align: center;
      background: transparent; border: none; box-shadow: none;
    }
    #splash-screen .card::before { display: none; }

    .splash-logo-wrap { position: relative; display: inline-block; margin-bottom: 12px; }
    .splash-logo {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(80px, 20vw, 130px);
      letter-spacing: 16px;
      background: linear-gradient(135deg, var(--cyan) 0%, var(--pink) 60%, var(--gold) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      display: block;
      animation: logoIntro 1s cubic-bezier(.17,.67,.35,1.4) both, logoPulse 4s ease-in-out 1s infinite;
      filter: drop-shadow(0 0 40px rgba(0,229,255,0.3));
    }
    @keyframes logoIntro {
      0%   { opacity: 0; transform: scale(0.5) translateY(40px); letter-spacing: 0; }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }
    @keyframes logoPulse {
      0%,100% { filter: drop-shadow(0 0 20px rgba(0,229,255,0.35)); }
      50%     { filter: drop-shadow(0 0 50px rgba(255,60,172,0.5)); }
    }

    .splash-ring {
      position: absolute; top: 50%; left: 50%;
      width: 200px; height: 200px; border-radius: 50%;
      border: 1px solid rgba(0,229,255,0.15);
      transform: translate(-50%,-50%);
      animation: ringOrbit 6s linear infinite;
      pointer-events: none;
    }
    .splash-ring::after {
      content: ''; position: absolute;
      top: -4px; left: calc(50% - 4px);
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--cyan); box-shadow: var(--glow-c);
    }
    @keyframes ringOrbit { from { transform: translate(-50%,-50%) rotate(0deg); } to { transform: translate(-50%,-50%) rotate(360deg); } }
    .splash-ring2 { width: 260px; height: 260px; border-color: rgba(255,60,172,0.1); animation: ringOrbit 10s linear infinite reverse; }
    .splash-ring2::after { background: var(--pink); box-shadow: var(--glow-p); }

    .splash-tagline {
      font-size: 13px; letter-spacing: 4px; text-transform: uppercase;
      color: var(--muted); margin-bottom: 8px; animation: fadeUp .8s .4s both;
    }
    .splash-desc {
      font-size: 15px; color: rgba(255,255,255,0.45); line-height: 1.7;
      margin-bottom: 40px; max-width: 320px; margin-left: auto; margin-right: auto;
      animation: fadeUp .8s .6s both;
    }
    body.light .splash-desc { color: rgba(0,0,0,0.45); }

    .particles { position: fixed; inset: 0; pointer-events: none; z-index: 5; }
    .particle {
      position: absolute; width: 4px; height: 4px; border-radius: 50%;
      animation: floatUp linear infinite; opacity: 0;
    }
    @keyframes floatUp {
      0%   { opacity: 0; transform: translateY(0) scale(0); }
      10%  { opacity: 1; }
      90%  { opacity: 0.6; }
      100% { opacity: 0; transform: translateY(-110vh) scale(1.5); }
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       â‘¡ NAME ENTRY SCREEN
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .name-logo {
      font-family: 'Bebas Neue', sans-serif; font-size: 38px; letter-spacing: 8px;
      background: linear-gradient(90deg, var(--cyan), var(--pink));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      text-align: center; margin-bottom: 4px;
    }
    .screen-subtitle {
      text-align: center; font-size: 12px; letter-spacing: 3px;
      text-transform: uppercase; color: var(--muted); margin-bottom: 32px;
    }

    .avatar-row {
      display: flex; gap: 10px; justify-content: center;
      margin-bottom: 16px; flex-wrap: wrap;
    }
    .avatar-opt {
      font-size: 26px; width: 48px; height: 48px; border-radius: 12px;
      border: 2px solid var(--border); background: var(--surf2);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: border-color .2s, transform .15s, box-shadow .2s, background .2s;
    }
    .avatar-opt:hover { transform: scale(1.1); border-color: var(--cyan); }
    .avatar-opt.selected {
      border-color: var(--cyan);
      box-shadow: 0 0 16px rgba(0,229,255,0.4);
      background: rgba(0,229,255,0.1);
    }

    /* Color theme picker */
    .color-label {
      font-size: 11px; letter-spacing: 2px; text-transform: uppercase;
      color: var(--muted); margin-bottom: 10px; display: block;
    }
    .color-row {
      display: flex; gap: 10px; justify-content: center; margin-bottom: 24px;
    }
    .color-swatch {
      width: 30px; height: 30px; border-radius: 50%; cursor: pointer;
      border: 3px solid transparent;
      transition: transform .15s, border-color .2s, box-shadow .2s;
    }
    .color-swatch:hover { transform: scale(1.15); }
    .color-swatch.selected {
      border-color: #fff;
      box-shadow: 0 0 14px rgba(255,255,255,0.5);
      transform: scale(1.15);
    }
    body.light .color-swatch.selected { border-color: #222; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SHARED FORM ELEMENTS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .field-label {
      font-size: 11px; letter-spacing: 2px; text-transform: uppercase;
      color: var(--muted); margin-bottom: 8px; display: block;
    }
    input[type="text"] {
      width: 100%; background: rgba(255,255,255,0.04);
      border: 1px solid var(--border); border-radius: 10px;
      padding: 13px 16px; color: var(--text);
      font-family: 'Syne', sans-serif; font-size: 15px;
      outline: none; transition: border-color .2s, box-shadow .2s, background .4s;
    }
    input[type="text"]::placeholder { color: var(--muted); font-size: 14px; }
    input[type="text"]:focus {
      border-color: var(--cyan);
      box-shadow: 0 0 0 3px rgba(0,229,255,0.12);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BUTTONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      gap: 8px; border: none; outline: none; cursor: pointer;
      font-family: 'Syne', sans-serif; font-weight: 700;
      font-size: 13px; letter-spacing: 1.5px; text-transform: uppercase;
      border-radius: 10px; padding: 13px 20px;
      transition: transform .15s, box-shadow .2s, opacity .15s;
      position: relative; overflow: hidden;
    }
    .btn::after {
      content: ''; position: absolute; inset: 0;
      background: rgba(255,255,255,0.08); opacity: 0; transition: opacity .15s;
    }
    .btn:hover::after { opacity: 1; }
    .btn:active { transform: scale(0.96) !important; }
    .btn:disabled { opacity: 0.28; cursor: not-allowed; transform: none !important; box-shadow: none !important; }
    .btn-full { width: 100%; }
    .btn-cyan { background: linear-gradient(135deg, var(--cyan), #007acc); color: #000; box-shadow: 0 4px 20px rgba(0,229,255,0.3); }
    .btn-cyan:hover { box-shadow: 0 6px 30px rgba(0,229,255,0.5); transform: translateY(-1px); }
    .btn-pink { background: linear-gradient(135deg, var(--pink), #8b00ff); color: #fff; box-shadow: 0 4px 20px rgba(255,60,172,0.3); }
    .btn-pink:hover { box-shadow: 0 6px 30px rgba(255,60,172,0.5); transform: translateY(-1px); }
    .btn-gold { background: linear-gradient(135deg, var(--gold), #ff8c00); color: #000; box-shadow: 0 4px 20px rgba(255,209,102,0.3); }
    .btn-gold:hover { box-shadow: 0 6px 30px rgba(255,209,102,0.5); transform: translateY(-1px); }
    .btn-ghost { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--text); transition: border-color .2s, background .4s; }
    .btn-ghost:hover { border-color: var(--cyan); }
    .btn-arena {
      padding: 16px 48px; font-size: 16px; letter-spacing: 3px;
      background: linear-gradient(135deg, var(--cyan) 0%, var(--pink) 100%);
      color: #fff; border-radius: 14px;
      box-shadow: 0 8px 40px rgba(0,229,255,0.35), 0 0 0 1px rgba(255,255,255,0.08) inset;
      animation: fadeUp .8s .9s both, arenaPulse 3s ease-in-out 1.7s infinite;
      width: 100%; max-width: 280px;
    }
    @keyframes arenaPulse {
      0%,100% { box-shadow: 0 8px 40px rgba(0,229,255,0.35); }
      50%      { box-shadow: 0 8px 60px rgba(255,60,172,0.55); }
    }
    .divider {
      display: flex; align-items: center; gap: 10px;
      color: var(--muted); font-size: 11px; letter-spacing: 2px;
      text-transform: uppercase; margin: 18px 0;
    }
    .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HOME SCREEN
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .btn-row { display: flex; gap: 10px; }
    .join-row { display: flex; gap: 8px; margin-top: 4px; }
    .join-row input { flex: 1; letter-spacing: 4px; text-transform: uppercase; }
    #home-msg { min-height: 18px; font-size: 13px; color: var(--pink); text-align: center; margin-top: 14px; animation: fadeUp .3s ease; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ROOM BADGE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .room-badge {
      background: rgba(0,229,255,0.06); border: 1px solid rgba(0,229,255,0.18);
      border-radius: 14px; padding: 14px 18px; margin-bottom: 22px;
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
    }
    body.light .room-badge { background: rgba(0,180,220,0.06); }
    .room-badge-label { font-size: 10px; letter-spacing: 2px; text-transform: uppercase; color: var(--muted); margin-bottom: 4px; }
    .room-badge-code { font-family: 'Bebas Neue', sans-serif; font-size: 30px; letter-spacing: 8px; color: var(--cyan); text-shadow: var(--glow-c); }
    .waiting-dots { display: flex; align-items: center; gap: 5px; font-size: 12px; color: var(--muted); }
    .dot { width: 5px; height: 5px; border-radius: 50%; background: var(--cyan); animation: blink 1.2s ease-in-out infinite; }
    .dot:nth-child(2) { animation-delay: .2s; }
    .dot:nth-child(3) { animation-delay: .4s; }
    @keyframes blink {
      0%,100% { opacity: 0.2; transform: scale(0.8); }
      50%      { opacity: 1;   transform: scale(1.2); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SETUP SCREEN
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .section-title { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 3px; margin-bottom: 4px; }
    .section-sub { font-size: 12px; color: var(--muted); margin-bottom: 16px; line-height: 1.5; }
    .progress-bar { height: 3px; background: var(--border); border-radius: 999px; overflow: hidden; margin-bottom: 16px; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--cyan), var(--pink)); width: 0%; transition: width .3s ease; border-radius: 999px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BINGO BOARD â€” responsive, no-scroll
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .board-wrap { display: flex; justify-content: center; margin-bottom: 16px; }
    .board {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(5, 1fr);
      gap: 6px;
      width: min(100%, min(calc(100vw - 64px), calc(100vh - 340px)));
    }
    .cell {
      border-radius: 10px; border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      display: flex; align-items: center; justify-content: center;
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(14px, 3.8vw, 22px);
      color: var(--text); cursor: pointer;
      transition: background .2s, border-color .2s, transform .15s, box-shadow .2s, color .4s;
      user-select: none; position: relative; overflow: hidden; aspect-ratio: 1;
    }
    body.light .cell { background: rgba(0,0,0,0.03); }

    #setup-board .cell:not([data-filled]):hover {
      background: rgba(0,229,255,0.07); border-color: rgba(0,229,255,0.35); transform: scale(1.06);
    }
    #setup-board .cell[data-filled] {
      background: rgba(0,229,255,0.09); border-color: rgba(0,229,255,0.3);
      color: var(--cyan); animation: cellPop .25s cubic-bezier(.17,.67,.35,1.4);
    }
    @keyframes cellPop {
      0%   { transform: scale(0.65); opacity: 0; }
      100% { transform: scale(1);    opacity: 1; }
    }

    #game-board .cell:not(.crossed):hover {
      background: rgba(255,209,102,0.09); border-color: rgba(255,209,102,0.35); transform: scale(1.07);
    }
    .cell.crossed {
      background: linear-gradient(135deg, rgba(0,229,255,0.18), rgba(255,60,172,0.18));
      border-color: var(--cyan); cursor: default;
      animation: crossPop .35s cubic-bezier(.17,.67,.35,1.4);
    }
    .cell.crossed::after {
      content: 'âœ•'; position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      color: var(--cyan); font-size: 1.3em; opacity: 0.55; text-shadow: var(--glow-c);
    }
    @keyframes crossPop {
      0%  { transform: scale(1.3); }
      60% { transform: scale(0.9); }
      100%{ transform: scale(1); }
    }

    /* â”€â”€ WINNING LINE GLOW â€” golden pulse for completed lines â”€â”€ */
    .cell.win-line {
      background: linear-gradient(135deg, rgba(255,209,102,0.28), rgba(255,140,0,0.22)) !important;
      border-color: var(--gold) !important;
      animation: winLinePulse 1.4s ease-in-out infinite !important;
      box-shadow: var(--win-glow) !important;
      color: var(--gold) !important;
      z-index: 2;
    }
    .cell.win-line::after { color: var(--gold) !important; text-shadow: 0 0 12px rgba(255,209,102,0.8) !important; }
    @keyframes winLinePulse {
      0%,100% { box-shadow: 0 0 14px rgba(255,209,102,0.5); border-color: var(--gold); }
      50%     { box-shadow: 0 0 32px rgba(255,209,102,0.9), 0 0 60px rgba(255,140,0,0.4); border-color: #ffdf7a; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GAME SCREEN LAYOUT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #game-screen .card { max-width: 520px; }
    #game-screen .card-body { padding: 20px 20px 18px; }

    /* Score tracker row */
    .score-row {
      display: flex; justify-content: center; align-items: center;
      gap: 14px; margin-bottom: 10px;
    }
    .score-box {
      display: flex; flex-direction: column; align-items: center;
      background: var(--surf2); border: 1px solid var(--border);
      border-radius: 10px; padding: 6px 18px;
      min-width: 60px; transition: background .4s;
    }
    .score-val {
      font-family: 'Bebas Neue', sans-serif; font-size: 28px;
      letter-spacing: 2px; line-height: 1;
    }
    .score-val.p1c { color: var(--cyan); }
    .score-val.p2c { color: var(--pink); }
    .score-lbl { font-size: 10px; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; margin-top: 2px; }
    .score-divider {
      font-family: 'Bebas Neue', sans-serif; font-size: 18px;
      color: var(--muted); letter-spacing: 2px;
    }

    /* Player name boxes */
    .players-row {
      display: flex; justify-content: space-between; align-items: center;
      gap: 8px; margin-bottom: 12px;
    }
    .player-box {
      display: flex; align-items: center; gap: 7px;
      background: var(--surf2); border: 1px solid var(--border);
      border-radius: 10px; padding: 7px 12px;
      font-size: 12px; font-weight: 600; letter-spacing: 0.5px;
      flex: 1; min-width: 0;
      transition: border-color .3s, box-shadow .3s, background .4s;
    }
    .player-box.p1 { border-color: rgba(0,229,255,0.25); }
    .player-box.p2 { border-color: rgba(255,60,172,0.25); flex-direction: row-reverse; text-align: right; }
    .player-box.active-turn { box-shadow: 0 0 14px rgba(255,209,102,0.3); border-color: var(--gold) !important; }
    .player-avatar { font-size: 18px; flex-shrink: 0; }
    .player-name { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .player-label { font-size: 10px; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; }
    .vs-badge { font-family: 'Bebas Neue', sans-serif; font-size: 16px; letter-spacing: 2px; color: var(--muted); flex-shrink: 0; }

    /* Turn indicator */
    #turn-indicator {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(16px, 4vw, 22px);
      letter-spacing: 3px; text-align: center;
      margin-bottom: 10px; min-height: 28px; transition: color .3s;
    }

    /* Action buttons row */
    .action-row { display: flex; gap: 8px; margin-top: 14px; }
    .action-row .btn { flex: 1; font-size: 12px; padding: 10px 8px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NUMBER CALL ANNOUNCEMENT OVERLAY
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #number-announce {
      position: fixed; inset: 0; z-index: 150;
      display: flex; align-items: center; justify-content: center;
      pointer-events: none;
    }
    .announce-bubble {
      background: linear-gradient(135deg, rgba(13,18,32,0.92), rgba(19,25,39,0.96));
      border: 2px solid var(--gold);
      border-radius: 24px; padding: 20px 44px;
      text-align: center;
      box-shadow: 0 0 40px rgba(255,209,102,0.4), 0 20px 60px rgba(0,0,0,0.6);
      transform: scale(0) translateY(20px);
      opacity: 0;
      transition: none;
    }
    body.light .announce-bubble {
      background: linear-gradient(135deg, rgba(255,255,255,0.96), rgba(240,244,255,0.98));
      box-shadow: 0 0 30px rgba(255,180,0,0.3), 0 16px 40px rgba(0,0,0,0.15);
    }
    .announce-bubble.pop {
      animation: announcePop .55s cubic-bezier(.17,.67,.35,1.4) forwards;
    }
    .announce-bubble.fade-out {
      animation: announceFade .35s ease forwards;
    }
    @keyframes announcePop {
      0%   { transform: scale(0.3) translateY(30px); opacity: 0; }
      60%  { transform: scale(1.08) translateY(-5px); opacity: 1; }
      100% { transform: scale(1) translateY(0); opacity: 1; }
    }
    @keyframes announceFade {
      0%   { transform: scale(1) translateY(0); opacity: 1; }
      100% { transform: scale(0.7) translateY(-20px); opacity: 0; }
    }
    .announce-who {
      font-size: 11px; letter-spacing: 3px; text-transform: uppercase;
      color: var(--gold); margin-bottom: 4px;
    }
    .announce-num {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(60px, 16vw, 100px);
      letter-spacing: 6px; line-height: 1;
      background: linear-gradient(135deg, var(--gold), var(--pink));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .announce-sub {
      font-size: 12px; color: var(--muted); letter-spacing: 2px; margin-top: 4px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       REMATCH COUNTDOWN IN WIN OVERLAY
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .rematch-countdown {
      font-size: 13px; color: var(--muted); letter-spacing: 2px;
      margin-top: 16px; text-align: center;
      animation: fadeUp .5s .8s both;
    }
    .rematch-countdown strong { color: var(--gold); font-size: 16px; }
    .countdown-cancel {
      background: none; border: none; cursor: pointer;
      color: var(--muted); font-size: 11px; letter-spacing: 1px;
      text-transform: uppercase; text-decoration: underline;
      font-family: 'Syne', sans-serif; margin-top: 6px; padding: 2px 6px;
    }
    .countdown-cancel:hover { color: var(--text); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CHAT / EMOJI MESSENGER (enhanced with text)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .chat-fab {
      position: fixed; bottom: 24px; right: 24px;
      width: 52px; height: 52px; border-radius: 50%;
      background: linear-gradient(135deg, var(--cyan), var(--pink));
      border: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px;
      box-shadow: 0 6px 24px rgba(0,229,255,0.4);
      z-index: 100;
      transition: transform .2s, box-shadow .2s;
      animation: fabPop .4s cubic-bezier(.17,.67,.35,1.4);
    }
    .chat-fab:hover { transform: scale(1.1); box-shadow: 0 8px 32px rgba(255,60,172,0.5); }
    @keyframes fabPop { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .chat-badge {
      position: absolute; top: -2px; right: -2px;
      width: 14px; height: 14px; border-radius: 50%;
      background: var(--gold); border: 2px solid var(--bg); display: none;
    }
    .chat-badge.show { display: block; }

    .chat-panel {
      position: fixed; bottom: 88px; right: 24px;
      width: 300px;
      background: var(--surf); border: 1px solid var(--border);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.06);
      z-index: 99; display: flex; flex-direction: column; overflow: hidden;
      transform: scale(0.85) translateY(20px);
      transform-origin: bottom right;
      opacity: 0; pointer-events: none;
      transition: transform .25s cubic-bezier(.4,0,.2,1), opacity .25s, background .4s;
    }
    .chat-panel.open { transform: scale(1) translateY(0); opacity: 1; pointer-events: all; }
    .chat-panel::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
      background: linear-gradient(90deg, var(--cyan), var(--pink));
    }
    .chat-header {
      padding: 14px 16px 10px; font-size: 11px; letter-spacing: 2px;
      text-transform: uppercase; color: var(--muted); border-bottom: 1px solid var(--border);
    }
    .chat-messages {
      flex: 1; overflow-y: auto; padding: 10px 12px;
      display: flex; flex-direction: column; gap: 6px;
      max-height: 200px; scrollbar-width: thin; scrollbar-color: var(--border) transparent;
    }
    .chat-msg { display: flex; flex-direction: column; gap: 2px; }
    .chat-msg.mine { align-items: flex-end; }
    .chat-bubble {
      display: inline-block; padding: 6px 10px; border-radius: 10px;
      font-size: 14px; max-width: 200px; word-break: break-word; line-height: 1.4;
      background: var(--surf2); border: 1px solid var(--border);
      animation: bubblePop .2s cubic-bezier(.17,.67,.35,1.4);
      transition: background .4s;
    }
    .chat-bubble.emoji-only { font-size: 22px; background: var(--surf2); }
    .chat-msg.mine .chat-bubble {
      background: rgba(0,229,255,0.1); border-color: rgba(0,229,255,0.2);
    }
    .chat-sender { font-size: 10px; color: var(--muted); letter-spacing: 0.5px; }
    @keyframes bubblePop { from { transform: scale(0.6); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .chat-emojis {
      display: flex; flex-wrap: wrap; gap: 6px;
      padding: 8px 12px; border-top: 1px solid var(--border);
    }
    .emoji-btn {
      font-size: 18px; width: 32px; height: 32px; border-radius: 8px;
      background: var(--surf2); border: 1px solid var(--border);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: transform .15s, border-color .15s, background .4s;
    }
    .emoji-btn:hover { transform: scale(1.2); border-color: var(--cyan); }

    /* Text input row in chat */
    .chat-input-row {
      display: flex; gap: 6px; padding: 8px 12px;
      border-top: 1px solid var(--border);
    }
    .chat-text-input {
      flex: 1; background: var(--surf2); border: 1px solid var(--border);
      border-radius: 8px; padding: 8px 10px;
      color: var(--text); font-family: 'Syne', sans-serif; font-size: 13px;
      outline: none; transition: border-color .2s, background .4s;
    }
    .chat-text-input:focus { border-color: var(--cyan); }
    .chat-text-input::placeholder { color: var(--muted); font-size: 12px; }
    .chat-send-btn {
      width: 34px; height: 34px; border-radius: 8px; border: none;
      background: linear-gradient(135deg, var(--cyan), var(--pink));
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      font-size: 15px; transition: transform .15s, box-shadow .2s;
      flex-shrink: 0;
    }
    .chat-send-btn:hover { transform: scale(1.08); box-shadow: 0 4px 14px rgba(0,229,255,0.4); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       WIN OVERLAY + CONFETTI
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #win-overlay {
      position: fixed; inset: 0; z-index: 200;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      background: rgba(7,9,15,0.88); backdrop-filter: blur(8px);
      opacity: 0; pointer-events: none;
      transition: opacity .4s; padding: 24px;
    }
    #win-overlay.show { opacity: 1; pointer-events: all; }
    .win-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(60px, 18vw, 100px);
      letter-spacing: 10px; line-height: 1;
      background: linear-gradient(135deg, var(--gold), var(--pink));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      animation: winBounce 1s cubic-bezier(.17,.67,.35,1.4) both; text-align: center;
    }
    @keyframes winBounce {
      0%   { transform: scale(0) rotate(-15deg); opacity: 0; }
      60%  { transform: scale(1.15) rotate(3deg); }
      80%  { transform: scale(0.95) rotate(-1deg); }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }
    .win-subtitle {
      font-size: 16px; color: rgba(255,255,255,0.55); margin-top: 8px; margin-bottom: 36px;
      letter-spacing: 2px; text-align: center; animation: fadeUp .6s .4s both;
    }
    body.light .win-subtitle { color: rgba(0,0,0,0.55); }
    .win-buttons {
      display: flex; gap: 12px; flex-wrap: wrap;
      justify-content: center; animation: fadeUp .6s .6s both;
    }
    #confetti-canvas { position: fixed; inset: 0; pointer-events: none; z-index: 199; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SETUP BOTTOM ROW
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .setup-actions { display: flex; gap: 8px; margin-bottom: 12px; }
    .setup-actions .btn { flex: 1; font-size: 12px; padding: 10px 8px; }

  </style>
</head>
<body>

<div class="bg-mesh"></div>
<div class="particles" id="particles"></div>
<canvas id="confetti-canvas"></canvas>

<!-- Theme Toggle -->
<button id="theme-toggle" title="Toggle theme">ğŸŒ™</button>

<!-- Number Announcement -->
<div id="number-announce">
  <div class="announce-bubble" id="announce-bubble">
    <div class="announce-who" id="announce-who">CALLED</div>
    <div class="announce-num" id="announce-num">â€”</div>
    <div class="announce-sub" id="announce-sub">picks this number</div>
  </div>
</div>

<!-- Win Overlay -->
<div id="win-overlay">
  <div class="win-title" id="win-title-text">YOU WIN!</div>
  <div class="win-subtitle" id="win-subtitle-text">Incredible performance ğŸ¯</div>
  <div class="win-buttons">
    <button class="btn btn-gold" id="win-restart-btn">â†º &nbsp;Restart Match</button>
    <button class="btn btn-ghost" id="win-reset-btn">â &nbsp;Exit</button>
  </div>
  <div class="rematch-countdown" id="rematch-countdown" style="display:none;">
    Auto-rematch in <strong id="countdown-val">10</strong>s
    <br><button class="countdown-cancel" id="countdown-cancel">Cancel</button>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â‘  SPLASH SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="splash-screen" class="screen active">
  <div class="card">
    <div class="card-body" style="text-align:center; padding: 48px 36px 52px;">
      <div class="splash-logo-wrap">
        <div class="splash-ring"></div>
        <div class="splash-ring splash-ring2"></div>
        <span class="splash-logo">DiNGo</span>
      </div>
      <p class="splash-tagline">Real-time Multiplayer</p>
      <p class="splash-desc">Place your numbers. Call the shots. Be the first to mark 5 lines and claim the arena.</p>
      <button class="btn btn-arena" id="enter-arena-btn">âš¡ &nbsp;Enter the Arena</button>
    </div>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â‘¡ NAME ENTRY SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="name-screen" class="screen">
  <div class="card">
    <div class="card-body">
      <div class="name-logo">DiNGo</div>
      <p class="screen-subtitle">Choose your identity</p>

      <p class="field-label">Pick an avatar</p>
      <div class="avatar-row" id="avatar-row"></div>

      <p class="field-label" style="margin-top:8px;">Pick your color</p>
      <div class="color-row" id="color-row"></div>

      <p class="field-label">Your name</p>
      <input type="text" id="player-name-input" maxlength="14" placeholder="e.g. Nova, Ace, Zaraâ€¦" style="margin-bottom:20px;" />

      <button class="btn btn-cyan btn-full" id="name-confirm-btn">â†’ &nbsp;Continue to Lobby</button>
    </div>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â‘¢ HOME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="home-screen" class="screen">
  <div class="card">
    <div class="card-body">
      <div class="name-logo">DiNGo</div>
      <p class="screen-subtitle">Multiplayer Â· Live</p>
      <button id="create-btn" class="btn btn-cyan btn-full">ï¼‹ &nbsp;Create Room</button>
      <div class="divider">or join existing</div>
      <div class="join-row">
        <input id="room-code-input" type="text" maxlength="4" placeholder="Room code e.g. A3K9" />
        <button id="join-btn" class="btn btn-ghost">Join</button>
      </div>
      <p id="home-msg"></p>
    </div>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â‘£ SETUP SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="setup-screen" class="screen">
  <div class="card">
    <div class="card-body">
      <div class="room-badge">
        <div>
          <div class="room-badge-label">Room Code</div>
          <div class="room-badge-code" id="display-room-code">â€”â€”</div>
          <div class="waiting-dots">
            <span class="dot"></span><span class="dot"></span><span class="dot"></span>
            <span id="waiting-label">Waiting for opponent</span>
          </div>
        </div>
      </div>
      <div class="section-title">Arrange Your Board</div>
      <p class="section-sub">Tap cells to place 1 â†’ 25 in any order, or shuffle randomly.</p>
      <div class="progress-bar"><div class="progress-fill" id="setup-progress"></div></div>
      <div class="setup-actions">
        <button class="btn btn-ghost" id="shuffle-btn">ğŸ”€ Random</button>
        <button class="btn btn-ghost" id="clear-btn">âœ• Clear</button>
      </div>
      <div class="board-wrap">
        <div class="board" id="setup-board"></div>
      </div>
      <button id="ready-btn" class="btn btn-pink btn-full" disabled>âœ“ &nbsp;I'm Ready!</button>
    </div>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â‘¤ GAME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="game-screen" class="screen">
  <div class="card">
    <div class="card-body">

      <!-- Score tracker -->
      <div class="score-row">
        <div class="score-box">
          <div class="score-val p1c" id="score-p1">0</div>
          <div class="score-lbl">P1 Wins</div>
        </div>
        <div class="score-divider">:</div>
        <div class="score-box">
          <div class="score-val p2c" id="score-p2">0</div>
          <div class="score-lbl">P2 Wins</div>
        </div>
      </div>

      <!-- Player name boxes -->
      <div class="players-row">
        <div class="player-box p1" id="p1-box">
          <span class="player-avatar" id="p1-avatar">ğŸ®</span>
          <div>
            <div class="player-label">Player 1</div>
            <div class="player-name" id="p1-name">â€”</div>
          </div>
        </div>
        <div class="vs-badge">VS</div>
        <div class="player-box p2" id="p2-box">
          <span class="player-avatar" id="p2-avatar">ğŸ•¹ï¸</span>
          <div style="text-align:right">
            <div class="player-label">Player 2</div>
            <div class="player-name" id="p2-name">â€”</div>
          </div>
        </div>
      </div>

      <!-- Turn indicator -->
      <div id="turn-indicator">Loadingâ€¦</div>

      <!-- Game board -->
      <div class="board-wrap">
        <div class="board" id="game-board"></div>
      </div>

      <!-- Reset / Restart -->
      <div class="action-row">
        <button class="btn btn-gold" id="restart-btn">â†º Restart</button>
        <button class="btn btn-ghost" id="reset-btn">â Exit</button>
      </div>
    </div>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CHAT FAB + PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<button class="chat-fab" id="chat-fab" style="display:none;">
  ğŸ’¬
  <div class="chat-badge" id="chat-badge"></div>
</button>

<div class="chat-panel" id="chat-panel">
  <div class="chat-header">ğŸ’¬ &nbsp;Chat</div>
  <div class="chat-messages" id="chat-messages"></div>
  <div class="chat-emojis" id="chat-emojis"></div>
  <div class="chat-input-row">
    <input type="text" class="chat-text-input" id="chat-text-input" placeholder="Type a messageâ€¦" maxlength="80" />
    <button class="chat-send-btn" id="chat-send-btn">â¤</button>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FIREBASE MODULE SCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import {
  getDatabase, ref, set, get, update, onValue, push
} from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

// â”€â”€ Firebase config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const firebaseConfig = {
  apiKey:            "AIzaSyAhhGzyMUJrfzYsOw4Uy-qu6F_IOqrh3PA",
  authDomain:        "dingo-v2-0.firebaseapp.com",
  databaseURL:       "https://dingo-v2-0-default-rtdb.firebaseio.com",
  projectId:         "dingo-v2-0",
  storageBucket:     "dingo-v2-0.firebasestorage.app",
  messagingSenderId: "908358383631",
  appId:             "1:908358383631:web:09473d12f079a230134b7a",
  measurementId:     "G-MFTX32JEDJ"
};
const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);

// â”€â”€ Game state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let myPlayerId   = Math.random().toString(36).substring(2, 9);
let roomId       = "";
let playerRole   = "";
let myBoard      = [];
let setupCounter = 1;
let playerName   = "Player";
let playerAvatar = "ğŸ®";
let playerColor  = "#00e5ff";
let chatOpen     = false;
let winShown     = false;
let countdownInterval = null;
// Scores stored locally (survive restarts within same session)
let scores = { p1: 0, p2: 0 };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SOUND ENGINE â€” Web Audio API tones, no external files
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let audioCtx = null;
function getAudio() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}

/**
 * Plays a short synthesised tone.
 * @param {number[]} freqs - Array of [frequency, startTime, duration] tuples
 * @param {string} type - oscillator type ('sine'|'square'|'sawtooth'|'triangle')
 * @param {number} vol - master gain (0-1)
 */
function playTone(notes, type = 'sine', vol = 0.18) {
  try {
    const ctx = getAudio();
    notes.forEach(([freq, start, dur]) => {
      const osc   = ctx.createOscillator();
      const gain  = ctx.createGain();
      osc.type      = type;
      osc.frequency.setValueAtTime(freq, ctx.currentTime + start);
      gain.gain.setValueAtTime(vol, ctx.currentTime + start);
      gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + start + dur);
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start(ctx.currentTime + start);
      osc.stop(ctx.currentTime + start + dur + 0.05);
    });
  } catch(e) { /* silently ignore if AudioContext is blocked */ }
}

// Individual sound events
const sfx = {
  // A soft click when placing a number in setup
  click: () => playTone([[880, 0, 0.08]], 'sine', 0.12),

  // Crossing off a number â€” punchy thud
  cross: () => playTone([
    [300, 0,    0.06],
    [200, 0.04, 0.1],
  ], 'triangle', 0.2),

  // Win fanfare â€” ascending arpeggio
  win: () => playTone([
    [523, 0,    0.12],
    [659, 0.1,  0.12],
    [784, 0.2,  0.12],
    [1047,0.3,  0.3],
    [1319,0.45, 0.5],
  ], 'sine', 0.22),

  // Lose â€” descending minor arpeggio
  lose: () => playTone([
    [392, 0,    0.12],
    [349, 0.12, 0.12],
    [294, 0.24, 0.25],
  ], 'triangle', 0.18),

  // New message ping
  ping: () => playTone([[1200, 0, 0.07], [900, 0.07, 0.12]], 'sine', 0.1),

  // Number announcement â€” attention-grabbing blip
  announce: () => playTone([[660, 0, 0.06], [880, 0.06, 0.12]], 'sine', 0.15),
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THEME TOGGLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const themeBtn = document.getElementById('theme-toggle');
let isLight = false;
themeBtn.addEventListener('click', () => {
  isLight = !isLight;
  document.body.classList.toggle('light', isLight);
  themeBtn.textContent = isLight ? 'â˜€ï¸' : 'ğŸŒ™';
  sfx.click();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCREENS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const screens = {
  splash: document.getElementById('splash-screen'),
  name:   document.getElementById('name-screen'),
  home:   document.getElementById('home-screen'),
  setup:  document.getElementById('setup-screen'),
  game:   document.getElementById('game-screen')
};
function showScreen(name) {
  Object.values(screens).forEach(s => s.classList.remove('active'));
  screens[name].classList.add('active');
}

// â”€â”€ Splash particles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function spawnParticles() {
  const container = document.getElementById('particles');
  const colors = ['#00e5ff','#ff3cac','#ffd166','#06ffa5'];
  for (let i = 0; i < 28; i++) {
    const p    = document.createElement('div');
    p.className = 'particle';
    const size  = 3 + Math.random() * 5;
    p.style.cssText = `left:${Math.random()*100}%;bottom:-10px;width:${size}px;height:${size}px;background:${colors[Math.floor(Math.random()*colors.length)]};animation-duration:${6+Math.random()*10}s;animation-delay:${Math.random()*8}s;border-radius:50%;`;
    container.appendChild(p);
  }
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AVATAR + COLOR PICKERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const AVATARS = ['ğŸ‘¹','ğŸ˜˜','ğŸ¦Š','ğŸ‰','ğŸ‘¾','ğŸ¤–','ğŸ¦‹','ğŸ”¥','âš¡','ğŸŒ™','ğŸ’','ğŸ¯'];
// 6 accent color options for player identity
const COLOR_SWATCHES = [
  { val: '#00e5ff', label: 'Cyan'   },
  { val: '#ff3cac', label: 'Pink'   },
  { val: '#06ffa5', label: 'Green'  },
  { val: '#ffd166', label: 'Gold'   },
  { val: '#a78bfa', label: 'Purple' },
  { val: '#ff6b6b', label: 'Red'    },
];

let selectedAvatar = AVATARS[0];
let selectedColor  = COLOR_SWATCHES[0].val;

// Render avatar options
const avatarRow = document.getElementById('avatar-row');
AVATARS.forEach(a => {
  const el = document.createElement('div');
  el.className   = 'avatar-opt' + (a === selectedAvatar ? ' selected' : '');
  el.textContent = a;
  el.addEventListener('click', () => {
    document.querySelectorAll('.avatar-opt').forEach(x => x.classList.remove('selected'));
    el.classList.add('selected');
    selectedAvatar = a;
    sfx.click();
  });
  avatarRow.appendChild(el);
});

// Render color swatches
const colorRow = document.getElementById('color-row');
COLOR_SWATCHES.forEach((c, i) => {
  const sw = document.createElement('div');
  sw.className   = 'color-swatch' + (i === 0 ? ' selected' : '');
  sw.style.background = c.val;
  sw.title       = c.label;
  sw.addEventListener('click', () => {
    document.querySelectorAll('.color-swatch').forEach(x => x.classList.remove('selected'));
    sw.classList.add('selected');
    selectedColor  = c.val;
    playerColor    = c.val;
    sfx.click();
  });
  colorRow.appendChild(sw);
});

// â”€â”€ Enter Arena â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('enter-arena-btn').addEventListener('click', () => {
  sfx.click();
  showScreen('name');
});

// â”€â”€ Name confirm â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('name-confirm-btn').addEventListener('click', () => {
  const input = document.getElementById('player-name-input').value.trim();
  playerName   = input || 'Player';
  playerAvatar = selectedAvatar;
  playerColor  = selectedColor;
  sfx.click();
  showScreen('home');
});
document.getElementById('player-name-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') document.getElementById('name-confirm-btn').click();
});

// â”€â”€ Room helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function genRoomId() {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  return Array.from({length:4}, () => chars[Math.floor(Math.random()*chars.length)]).join('');
}

// â”€â”€ Create Room â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('create-btn').addEventListener('click', async () => {
  sfx.click();
  roomId     = genRoomId();
  playerRole = "p1";

  await set(ref(db, `rooms/${roomId}`), {
    players:   { p1: myPlayerId },
    playerInfo:{ p1: { name: playerName, avatar: playerAvatar, color: playerColor } },
    gameState: { status:"waiting", currentTurn:"p1", selectedNumbers:[0], winner:"" },
    scores:    { p1: 0, p2: 0 }
  });

  document.getElementById('display-room-code').innerText = roomId;
  document.getElementById('waiting-label').innerText = 'Waiting for opponentâ€¦';
  initSetupBoard();
  showScreen('setup');
  showChat();

  onValue(ref(db, `rooms/${roomId}/playerInfo`), snap => {
    const info = snap.val();
    if (info && info.p2) {
      document.getElementById('p2-name').textContent   = info.p2.name;
      document.getElementById('p2-avatar').textContent = info.p2.avatar;
      document.getElementById('waiting-label').textContent = `${info.p2.name} joined!`;
    }
    if (info && info.p1) {
      document.getElementById('p1-name').textContent   = info.p1.name;
      document.getElementById('p1-avatar').textContent = info.p1.avatar;
    }
  });
  // Sync scores from Firebase in case of reconnect
  onValue(ref(db, `rooms/${roomId}/scores`), snap => {
    const s = snap.val();
    if (s) {
      scores.p1 = s.p1 || 0;
      scores.p2 = s.p2 || 0;
      updateScoreDisplay();
    }
  });
});

// â”€â”€ Join Room â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('join-btn').addEventListener('click', async () => {
  sfx.click();
  const code = document.getElementById('room-code-input').value.trim().toUpperCase();
  if (!code) return;
  const roomRef  = ref(db, `rooms/${code}`);
  const snapshot = await get(roomRef);
  if (snapshot.exists() && !snapshot.val().players.p2) {
    roomId     = code;
    playerRole = "p2";
    await update(roomRef, {
      'players/p2':            myPlayerId,
      'playerInfo/p2/name':    playerName,
      'playerInfo/p2/avatar':  playerAvatar,
      'playerInfo/p2/color':   playerColor,
    });
    const info = snapshot.val().playerInfo || {};
    document.getElementById('display-room-code').innerText = roomId;
    document.getElementById('p1-name').textContent   = info.p1 ? info.p1.name   : 'P1';
    document.getElementById('p1-avatar').textContent = info.p1 ? info.p1.avatar : 'ğŸ®';
    document.getElementById('p2-name').textContent   = playerName;
    document.getElementById('p2-avatar').textContent = playerAvatar;
    document.getElementById('waiting-label').textContent = 'You joined!';
    initSetupBoard();
    showScreen('setup');
    showChat();
    onValue(ref(db, `rooms/${roomId}/scores`), snap => {
      const s = snap.val();
      if (s) { scores.p1 = s.p1 || 0; scores.p2 = s.p2 || 0; updateScoreDisplay(); }
    });
  } else {
    const msg = document.getElementById('home-msg');
    msg.textContent = "Room full or not found!";
    setTimeout(() => { msg.textContent = ''; }, 3000);
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCORE DISPLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateScoreDisplay() {
  document.getElementById('score-p1').textContent = scores.p1;
  document.getElementById('score-p2').textContent = scores.p2;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETUP BOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initSetupBoard() {
  const boardDiv = document.getElementById('setup-board');
  boardDiv.innerHTML = '';
  myBoard      = new Array(25).fill(null);
  setupCounter = 1;
  document.getElementById('setup-progress').style.width = '0%';
  document.getElementById('ready-btn').disabled = true;
  for (let i = 0; i < 25; i++) {
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.dataset.idx = i;
    cell.addEventListener('click', () => placeNumber(cell, i));
    boardDiv.appendChild(cell);
  }
}

function placeNumber(cell, idx) {
  if (cell.dataset.filled || setupCounter > 25) return;
  cell.textContent    = setupCounter;
  cell.dataset.filled = 'true';
  myBoard[idx]        = setupCounter;
  setupCounter++;
  sfx.click();
  document.getElementById('setup-progress').style.width = ((setupCounter-1)/25*100) + '%';
  if (setupCounter > 25) document.getElementById('ready-btn').disabled = false;
}

document.getElementById('shuffle-btn').addEventListener('click', () => {
  sfx.click();
  const nums = Array.from({length:25}, (_,i) => i+1);
  for (let i = nums.length-1; i > 0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [nums[i],nums[j]] = [nums[j],nums[i]];
  }
  myBoard      = [...nums];
  setupCounter = 26;
  const cells  = document.querySelectorAll('#setup-board .cell');
  cells.forEach((cell, i) => {
    cell.textContent    = nums[i];
    cell.dataset.filled = 'true';
    cell.style.animation = 'none';
    requestAnimationFrame(() => { cell.style.animation = ''; });
  });
  document.getElementById('setup-progress').style.width = '100%';
  document.getElementById('ready-btn').disabled = false;
});

document.getElementById('clear-btn').addEventListener('click', () => {
  sfx.click();
  initSetupBoard();
});

// â”€â”€ Ready â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('ready-btn').addEventListener('click', async () => {
  sfx.click();
  document.getElementById('ready-btn').disabled  = true;
  document.getElementById('ready-btn').textContent = 'â³ Waitingâ€¦';
  await update(ref(db, `rooms/${roomId}/boards`), { [playerRole]: myBoard });
  onValue(ref(db, `rooms/${roomId}/boards`), (snap) => {
    const boards = snap.val();
    if (boards && boards.p1 && boards.p2) {
      update(ref(db, `rooms/${roomId}/gameState`), { status:"playing" });
      startGame();
    }
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NUMBER ANNOUNCE OVERLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let announceTimer = null;
function showAnnouncement(num, callerName, isMe) {
  sfx.announce();
  const bubble  = document.getElementById('announce-bubble');
  const whoEl   = document.getElementById('announce-who');
  const numEl   = document.getElementById('announce-num');
  const subEl   = document.getElementById('announce-sub');

  // Reset animation classes so it can replay
  bubble.classList.remove('pop', 'fade-out');
  void bubble.offsetWidth; // force reflow

  whoEl.textContent = isMe ? 'YOU CALLED' : callerName.toUpperCase();
  numEl.textContent = num;
  subEl.textContent = isMe ? 'nicely done' : 'crosses it out';

  bubble.classList.add('pop');

  // Clear any pending fade timer and set a new one
  if (announceTimer) clearTimeout(announceTimer);
  announceTimer = setTimeout(() => {
    bubble.classList.remove('pop');
    bubble.classList.add('fade-out');
  }, 1600);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// START GAME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startGame() {
  if (winShown) return;
  winShown = false;
  showScreen('game');
  const boardDiv = document.getElementById('game-board');
  boardDiv.innerHTML = '';

  // Track last known selectedNumbers length to detect NEW numbers
  let lastSelectedLen = 0;
  // Track which player names are visible
  onValue(ref(db, `rooms/${roomId}/playerInfo`), snap => {
    const info = snap.val() || {};
    if (info.p1) { document.getElementById('p1-name').textContent = info.p1.name; document.getElementById('p1-avatar').textContent = info.p1.avatar; }
    if (info.p2) { document.getElementById('p2-name').textContent = info.p2.name; document.getElementById('p2-avatar').textContent = info.p2.avatar; }
  });

  // Render board cells
  myBoard.forEach(num => {
    const cell = document.createElement('div');
    cell.className  = 'cell';
    cell.textContent = num;
    cell.id          = `cell-${num}`;
    cell.addEventListener('click', () => handleNumberClick(num));
    boardDiv.appendChild(cell);
  });

  // Real-time game state listener
  onValue(ref(db, `rooms/${roomId}/gameState`), snap => {
    const state = snap.val();
    if (!state) return;

    const turnText = document.getElementById('turn-indicator');
    document.getElementById('p1-box').classList.toggle('active-turn', state.currentTurn === 'p1');
    document.getElementById('p2-box').classList.toggle('active-turn', state.currentTurn === 'p2');

    if (state.winner && !winShown) {
      winShown = true;
      const iWon = state.winner === playerRole;
      // Update score in Firebase (only the winner's client writes to avoid race)
      if (iWon) {
        scores[playerRole]++;
        update(ref(db, `rooms/${roomId}/scores`), { [playerRole]: scores[playerRole] });
      }
      // Highlight winning lines before showing overlay
      if (state.selectedNumbers) {
        checkAndHighlightWin(state.selectedNumbers);
      }
      setTimeout(() => showWinOverlay(iWon), 500);
      turnText.innerText = '';
      return;
    }

    turnText.innerText = state.currentTurn === playerRole ? 'Your Turn!' : "Opponent's Turnâ€¦";

    if (state.selectedNumbers) {
      // Detect newly added number and show announcement
      if (state.selectedNumbers.length > lastSelectedLen) {
        const newNum = state.selectedNumbers[state.selectedNumbers.length - 1];
        if (newNum !== 0) {
          // Determine who called it â€” if it's now our turn, the OTHER player just went
          const caller     = state.currentTurn === playerRole ? (playerRole === 'p1' ? 'p2' : 'p1') : playerRole;
          // Get caller name
          get(ref(db, `rooms/${roomId}/playerInfo/${caller}/name`)).then(s => {
            const cName = s.val() || 'Opponent';
            const isMe  = caller === playerRole;
            showAnnouncement(newNum, cName, isMe);
          });
        }
      }
      lastSelectedLen = state.selectedNumbers.length;

      // Cross off cells
      state.selectedNumbers.forEach(num => {
        if (num !== 0) {
          const c = document.getElementById(`cell-${num}`);
          if (c && !c.classList.contains('crossed')) {
            c.classList.add('crossed');
            sfx.cross();
          }
        }
      });
      checkAndHighlightWin(state.selectedNumbers);
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HANDLE CLICK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function handleNumberClick(num) {
  const stateRef = ref(db, `rooms/${roomId}/gameState`);
  const snap     = await get(stateRef);
  const state    = snap.val();
  if (state.currentTurn === playerRole && !state.winner && !state.selectedNumbers.includes(num)) {
    const newSelected = [...state.selectedNumbers, num];
    const nextTurn    = playerRole === "p1" ? "p2" : "p1";
    await update(stateRef, { selectedNumbers: newSelected, currentTurn: nextTurn });
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WIN CHECK + WINNING LINE HIGHLIGHT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkAndHighlightWin(selectedNumbers) {
  const hits  = myBoard.map(n => selectedNumbers.includes(n) ? 1 : 0);
  let lines   = 0;
  const winIndices = new Set();

  // Rows â€” indices 0-4, 5-9, 10-14, 15-19, 20-24
  for (let r = 0; r < 5; r++) {
    const base = r * 5;
    const row  = [base, base+1, base+2, base+3, base+4];
    if (row.every(i => hits[i])) { row.forEach(i => winIndices.add(i)); lines++; }
  }
  // Columns
  for (let c = 0; c < 5; c++) {
    const col = [c, c+5, c+10, c+15, c+20];
    if (col.every(i => hits[i])) { col.forEach(i => winIndices.add(i)); lines++; }
  }
  // Diagonals
  const d1 = [0,6,12,18,24];
  if (d1.every(i => hits[i])) { d1.forEach(i => winIndices.add(i)); lines++; }
  const d2 = [4,8,12,16,20];
  if (d2.every(i => hits[i])) { d2.forEach(i => winIndices.add(i)); lines++; }

  // Apply golden glow to winning cells
  winIndices.forEach(idx => {
    const num  = myBoard[idx];
    const cell = document.getElementById(`cell-${num}`);
    if (cell) cell.classList.add('win-line');
  });

  // Trigger win condition (5 lines needed)
  if (lines >= 5) {
    update(ref(db, `rooms/${roomId}/gameState`), { winner: playerRole });
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WIN OVERLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const winPhrases  = ["Domination! ğŸ‘‘","Flawless Victory! âš¡","You're on fire! ğŸ”¥","GG! Absolutely lethal ğŸ¯","Champion energy! ğŸ’"];
const losePhrases = ["So closeâ€¦ Try again ğŸ’ª","Next time you'll have it!","Respect the grind ğŸ¤"];

function showWinOverlay(iWon) {
  if (iWon) { sfx.win(); } else { sfx.lose(); }
  const overlay = document.getElementById('win-overlay');
  document.getElementById('win-title-text').textContent   = iWon ? 'ğŸ‰ YOU WIN!' : 'ğŸ˜¢ YOU LOSE';
  document.getElementById('win-subtitle-text').textContent = iWon
    ? winPhrases[Math.floor(Math.random()*winPhrases.length)]
    : losePhrases[Math.floor(Math.random()*losePhrases.length)];
  overlay.classList.add('show');
  if (iWon) launchConfetti();
  startRematchCountdown();
  updateScoreDisplay();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REMATCH COUNTDOWN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startRematchCountdown() {
  const countdownDiv  = document.getElementById('rematch-countdown');
  const countdownVal  = document.getElementById('countdown-val');
  const cancelBtn     = document.getElementById('countdown-cancel');
  let timeLeft = 10;

  countdownDiv.style.display = 'block';
  countdownVal.textContent   = timeLeft;

  // Clear any existing interval
  if (countdownInterval) clearInterval(countdownInterval);

  countdownInterval = setInterval(() => {
    timeLeft--;
    countdownVal.textContent = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(countdownInterval);
      countdownDiv.style.display = 'none';
      doRestart(); // auto-rematch
    }
  }, 1000);

  cancelBtn.onclick = () => {
    clearInterval(countdownInterval);
    countdownDiv.style.display = 'none';
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFETTI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function launchConfetti() {
  const canvas = document.getElementById('confetti-canvas');
  const ctx    = canvas.getContext('2d');
  canvas.width  = window.innerWidth;
  canvas.height = window.innerHeight;
  const colors  = ['#00e5ff','#ff3cac','#ffd166','#06ffa5','#ffffff','#ff6b6b'];
  const pieces  = Array.from({length:180}, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height - canvas.height,
    w: 6 + Math.random() * 8, h: 10 + Math.random() * 14,
    c: colors[Math.floor(Math.random()*colors.length)],
    r: Math.random() * Math.PI * 2,
    rd: (Math.random() - 0.5) * 0.2,
    vy: 3 + Math.random() * 5,
    vx: (Math.random()-0.5) * 3
  }));
  let frame;
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    pieces.forEach(p => {
      p.y += p.vy; p.x += p.vx; p.r += p.rd; p.vy += 0.08;
      if (p.y > canvas.height) { p.y = -20; p.x = Math.random()*canvas.width; }
      ctx.save();
      ctx.translate(p.x + p.w/2, p.y + p.h/2);
      ctx.rotate(p.r); ctx.fillStyle = p.c; ctx.globalAlpha = 0.85;
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();
    });
    frame = requestAnimationFrame(draw);
  }
  draw();
  setTimeout(() => { cancelAnimationFrame(frame); ctx.clearRect(0, 0, canvas.width, canvas.height); }, 5000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESTART / RESET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function doRestart() {
  if (countdownInterval) { clearInterval(countdownInterval); }
  winShown = false;
  document.getElementById('win-overlay').classList.remove('show');
  document.getElementById('rematch-countdown').style.display = 'none';
  // Clear win-line highlights
  document.querySelectorAll('.cell.win-line').forEach(c => c.classList.remove('win-line'));
  await update(ref(db, `rooms/${roomId}/gameState`), {
    status:"waiting", currentTurn:"p1", selectedNumbers:[0], winner:""
  });
  await set(ref(db, `rooms/${roomId}/boards`), null);
  initSetupBoard();
  showScreen('setup');
  document.getElementById('ready-btn').disabled  = true;
  document.getElementById('ready-btn').textContent = "âœ“ I'm Ready!";
  sfx.click();
}

function doReset() {
  if (countdownInterval) clearInterval(countdownInterval);
  location.reload();
}

document.getElementById('win-restart-btn').addEventListener('click', doRestart);
document.getElementById('win-reset-btn').addEventListener('click',   doReset);
document.getElementById('restart-btn').addEventListener('click', doRestart);
document.getElementById('reset-btn').addEventListener('click',   doReset);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHAT SYSTEM â€” emoji + text
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CHAT_EMOJIS = ['ğŸ‘','ğŸ”¥','ğŸ˜‚','ğŸ˜±','ğŸ¯','ğŸ’€','ğŸ†','ğŸ˜¤','ğŸ¤¯','ğŸ‘','ğŸ˜ˆ','ğŸ«¡'];

function showChat() {
  const fab = document.getElementById('chat-fab');
  fab.style.display = 'flex';

  // Render emoji quick-react buttons
  const emojiBar = document.getElementById('chat-emojis');
  emojiBar.innerHTML = '';
  CHAT_EMOJIS.forEach(em => {
    const btn = document.createElement('button');
    btn.className   = 'emoji-btn';
    btn.textContent = em;
    btn.addEventListener('click', () => {
      sendMessage(em, true);
      // Auto-close the chat panel after sending
      chatOpen = false;
      document.getElementById('chat-panel').classList.remove('open');
    });
    emojiBar.appendChild(btn);
  });

  // Listen for all chat messages from Firebase
  onValue(ref(db, `rooms/${roomId}/chat`), snap => {
    const msgs      = snap.val();
    if (!msgs) return;
    const container = document.getElementById('chat-messages');
    container.innerHTML = '';
    Object.values(msgs).slice(-40).forEach(m => {
      const wrap   = document.createElement('div');
      wrap.className = 'chat-msg' + (m.sender === playerRole ? ' mine' : '');
      const bubble = document.createElement('div');
      // Emoji-only messages get a larger style
      bubble.className   = 'chat-bubble' + (m.isEmoji ? ' emoji-only' : '');
      bubble.textContent = m.text;
      const sender = document.createElement('div');
      sender.className   = 'chat-sender';
      sender.textContent = m.senderName;
      wrap.appendChild(bubble);
      wrap.appendChild(sender);
      container.appendChild(wrap);
    });
    container.scrollTop = container.scrollHeight;
    if (!chatOpen) {
      document.getElementById('chat-badge').classList.add('show');
      sfx.ping();
    }
  });
}

async function sendMessage(text, isEmoji = false) {
  if (!text.trim()) return;
  await push(ref(db, `rooms/${roomId}/chat`), {
    text, isEmoji,
    sender:     playerRole,
    senderName: playerName,
    ts:         Date.now()
  });
}

// Text input handler
document.getElementById('chat-send-btn').addEventListener('click', () => {
  const input = document.getElementById('chat-text-input');
  const txt   = input.value.trim();
  if (txt) {
    sendMessage(txt, false);
    input.value = '';
    // Auto-close the chat panel after sending
    chatOpen = false;
    document.getElementById('chat-panel').classList.remove('open');
  }
});
document.getElementById('chat-text-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') document.getElementById('chat-send-btn').click();
});

document.getElementById('chat-fab').addEventListener('click', () => {
  chatOpen = !chatOpen;
  document.getElementById('chat-panel').classList.toggle('open', chatOpen);
  if (chatOpen) {
    document.getElementById('chat-badge').classList.remove('show');
    document.getElementById('chat-messages').scrollTop = 9999;
  }
});

</script>
</body>
</html>
