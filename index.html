<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>DiNGo â€” Live Multiplayer Bingo</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESIGN TOKENS (PRESERVED)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --bg: #07090f; --surf: #0d1220; --surf2: #131927; --border: rgba(255,255,255,0.07);
      --cyan: #00e5ff; --pink: #ff3cac; --gold: #ffd166; --green: #06ffa5;
      --text: #dde6f0; --muted: #4e5f78; --radius: 14px;
      --glow-c: 0 0 28px rgba(0,229,255,0.4); --glow-p: 0 0 28px rgba(255,60,172,0.4);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width: 100%; height: 100%; overflow: hidden; font-family: 'Syne', sans-serif; background: var(--bg); color: var(--text); }

    /* ORIGINAL NEON MESH BACKGROUND */
    .bg-mesh { position: fixed; inset: -60%; z-index: 0; background: radial-gradient(ellipse 55% 45% at 15% 25%, rgba(0,229,255,0.09) 0%, transparent 55%), radial-gradient(ellipse 45% 55% at 85% 75%, rgba(255,60,172,0.08) 0%, transparent 55%); animation: meshDrift 20s ease-in-out infinite alternate; pointer-events: none; }
    @keyframes meshDrift { from { transform: translate(0,0) rotate(0deg); } to { transform: translate(4%,3%) rotate(4deg); } }

    /* NEW: GLOWING WIN-LINE EFFECT */
    .cell.winning-line {
      background: linear-gradient(135deg, var(--gold), #ff8c00) !important;
      color: #000 !important;
      box-shadow: 0 0 25px var(--gold);
      animation: lineGlow 0.8s ease-in-out infinite alternate;
      z-index: 5;
    }
    @keyframes lineGlow { from { opacity: 0.7; transform: scale(1); } to { opacity: 1; transform: scale(1.08); } }

    /* UI SCREENS & CARDS */
    .screen { position: fixed; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 16px; opacity: 0; pointer-events: none; transform: translateY(20px) scale(0.97); transition: all .45s cubic-bezier(.4,0,.2,1); z-index: 10; }
    .screen.active { opacity: 1; pointer-events: all; transform: translateY(0) scale(1); }
    .card { background: var(--surf); border: 1px solid var(--border); border-radius: 24px; width: 100%; max-width: 440px; position: relative; box-shadow: 0 40px 100px rgba(0,0,0,0.6); overflow: hidden; }
    .card::before { content: ''; position: absolute; top: 0; inset: 0 0 auto 0; height: 2px; background: linear-gradient(90deg, var(--cyan), var(--pink)); }
    .card-body { padding: 32px; }

    /* BOARD & CELLS */
    .board { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; width: 100%; aspect-ratio: 1; }
    .cell { border-radius: 10px; border: 1px solid var(--border); background: rgba(255,255,255,0.03); display: flex; align-items: center; justify-content: center; font-family: 'Bebas Neue'; font-size: 24px; cursor: pointer; transition: 0.2s; position: relative; }
    .cell.crossed { background: linear-gradient(135deg, rgba(0,229,255,0.18), rgba(255,60,172,0.18)); border-color: var(--cyan); color: var(--cyan); }
    .cell.crossed::after { content: 'âœ•'; position: absolute; opacity: 0.4; font-size: 14px; }

    /* BUTTONS */
    .btn { display: flex; align-items: center; justify-content: center; gap: 8px; border: none; cursor: pointer; font-family: 'Syne'; font-weight: 700; text-transform: uppercase; border-radius: 10px; padding: 13px 20px; transition: 0.2s; width: 100%; }
    .btn-cyan { background: linear-gradient(135deg, var(--cyan), #007acc); color: #000; box-shadow: var(--glow-c); }
    .btn-ghost { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--text); }
    input { width: 100%; background: var(--surf2); border: 1px solid var(--border); border-radius: 10px; padding: 12px; color: #fff; text-align: center; margin-bottom: 10px; font-family: 'Syne'; outline: none; }

    /* CHAT (AUTO-CLOSE READY) */
    .chat-fab { position: fixed; bottom: 24px; right: 24px; width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, var(--cyan), var(--pink)); border: none; cursor: pointer; font-size: 24px; z-index: 100; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
    .chat-panel { position: fixed; bottom: 90px; right: 24px; width: 260px; background: var(--surf); border: 1px solid var(--border); border-radius: 20px; transform: scale(0.9); opacity: 0; pointer-events: none; transition: 0.2s; z-index: 99; padding: 15px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
    .chat-panel.open { transform: scale(1); opacity: 1; pointer-events: all; }
    .emoji-btn { font-size: 22px; width: 42px; height: 42px; background: var(--surf2); border: 1px solid var(--border); border-radius: 10px; cursor: pointer; margin: 4px; transition: 0.2s; }
    .emoji-btn:hover { transform: scale(1.1); border-color: var(--cyan); }
    .close-x { position: absolute; top: 10px; right: 10px; background: none; border: none; color: var(--muted); cursor: pointer; }
  </style>
</head>
<body>

<div class="bg-mesh"></div>

<div id="splash-screen" class="screen active">
  <div class="card" style="background:transparent; border:none; box-shadow:none;">
    <div class="card-body" style="text-align:center;">
        <h1 style="font-family:'Bebas Neue'; font-size: 110px; background: linear-gradient(135deg, var(--cyan), var(--pink)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 20px;">DiNGo</h1>
        <button class="btn btn-cyan" onclick="showScreen('home')">âš¡ Enter Arena</button>
    </div>
  </div>
</div>

<div id="home-screen" class="screen">
  <div class="card">
    <div class="card-body">
      <h2 style="font-family:'Bebas Neue'; letter-spacing: 4px; text-align:center; margin-bottom:20px; color:var(--cyan);">Multiplayer Lobby</h2>
      <button id="create-btn" class="btn btn-cyan">ï¼‹ Create Room</button>
      <div style="text-align:center; color:var(--muted); margin:15px 0; font-size:10px; letter-spacing:2px;">OR JOIN MATCH</div>
      <input id="room-code-input" type="text" placeholder="ENTER 4-DIGIT CODE" maxlength="4">
      <button id="join-btn" class="btn btn-ghost">Join Arena</button>
    </div>
  </div>
</div>

<div id="setup-screen" class="screen">
  <div class="card">
    <div class="card-body">
      <div style="background:rgba(0,229,255,0.05); padding:15px; border-radius:15px; text-align:center; margin-bottom:20px; border: 1px solid rgba(0,229,255,0.1);">
        <div style="font-size:10px; color:var(--muted); text-transform:uppercase; letter-spacing: 2px;">Invite Code</div>
        <div id="display-room-code" style="font-family:'Bebas Neue'; font-size:36px; color:var(--cyan); letter-spacing: 5px;">----</div>
      </div>
      <div id="setup-board" class="board"></div>
      <div style="display:flex; gap:10px; margin-top:20px;">
        <button id="ready-btn" class="btn btn-cyan" disabled>âœ“ I'm Ready</button>
        <button class="btn btn-ghost" onclick="location.reload()">â Home</button>
      </div>
    </div>
  </div>
</div>

<div id="game-screen" class="screen">
  <div class="card">
    <div class="card-body">
      <div id="turn-indicator" style="font-family:'Bebas Neue'; font-size:28px; text-align:center; margin-bottom:15px; letter-spacing: 2px;">Connecting...</div>
      <div id="game-board" class="board"></div>
      <button class="btn btn-ghost" style="margin-top:25px;" onclick="location.reload()">â Quit Match</button>
    </div>
  </div>
</div>

<button id="chat-fab" class="chat-fab" style="display:none;">ğŸ’¬</button>
<div id="chat-panel" class="chat-panel">
  <button class="close-x" id="close-chat">âœ•</button>
  <div style="font-size:10px; color:var(--muted); margin-bottom:10px; letter-spacing:1px; text-align:center;">QUICK CHAT</div>
  <div id="emoji-list" style="display:flex; flex-wrap:wrap; justify-content:center;"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
  import { getDatabase, ref, set, get, update, onValue, push } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

  // YOUR FIREBASE CONFIG
  const firebaseConfig = {
    apiKey: "AIzaSyCPr1ZTE5450Qv1OhF2S13h12835sodmOw",
    authDomain: "dingo-beta-c280a.firebaseapp.com",
    databaseURL: "https://dingo-beta-c280a-default-rtdb.firebaseio.com",
    projectId: "dingo-beta-c280a",
    appId: "1:842477284115:web:613295de28df40ed2a48e6"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let myPlayerId = Math.random().toString(36).substring(7);
  let roomId = "", playerRole = "", myBoard = [], setupCounter = 1;

  window.showScreen = (id) => {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id + '-screen').classList.add('active');
  };

  // ROOM LOGIC
  document.getElementById('create-btn').onclick = async () => {
    roomId = Math.random().toString(36).substring(2, 6).toUpperCase();
    playerRole = "p1";
    await set(ref(db, `rooms/${roomId}`), {
      players: { p1: myPlayerId },
      gameState: { status: "waiting", currentTurn: "p1", selectedNumbers: [0] }
    });
    initSetup();
  };

  document.getElementById('join-btn').onclick = async () => {
    const code = document.getElementById('room-code-input').value.toUpperCase();
    if(!code) return;
    const snap = await get(ref(db, `rooms/${code}`));
    if (snap.exists() && !snap.val().players.p2) {
      roomId = code; playerRole = "p2";
      await update(ref(db, `rooms/${roomId}/players`), { p2: myPlayerId });
      initSetup();
    }
  };

  function initSetup() {
    showScreen('setup');
    document.getElementById('display-room-code').innerText = roomId;
    const boardDiv = document.getElementById('setup-board');
    boardDiv.innerHTML = ''; myBoard = new Array(25).fill(null); setupCounter = 1;

    for (let i = 0; i < 25; i++) {
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.onclick = () => {
        if (!cell.innerText && setupCounter <= 25) {
          cell.innerText = setupCounter; myBoard[i] = setupCounter; setupCounter++;
          if (setupCounter > 25) document.getElementById('ready-btn').disabled = false;
        }
      };
      boardDiv.appendChild(cell);
    }
  }

  document.getElementById('ready-btn').onclick = async () => {
    await update(ref(db, `rooms/${roomId}/boards`), { [playerRole]: myBoard });
    onValue(ref(db, `rooms/${roomId}/boards`), (snap) => {
      if (snap.val()?.p1 && snap.val()?.p2) startGame();
    });
  };

  // GAME ENGINE
  function startGame() {
    showScreen('game');
    document.getElementById('chat-fab').style.display = 'block';
    const boardDiv = document.getElementById('game-board');
    boardDiv.innerHTML = '';
    
    myBoard.forEach(num => {
      const cell = document.createElement('div');
      cell.className = 'cell'; cell.id = `cell-${num}`; cell.innerText = num;
      cell.onclick = () => handleMove(num);
      boardDiv.appendChild(cell);
    });

    onValue(ref(db, `rooms/${roomId}/gameState`), (snap) => {
      const state = snap.val();
      const indicator = document.getElementById('turn-indicator');
      if (state.winner) {
        indicator.innerText = state.winner === playerRole ? "ğŸ† VICTORY!" : "ğŸ’€ DEFEAT";
        indicator.style.color = state.winner === playerRole ? "var(--cyan)" : "var(--pink)";
        return;
      }
      indicator.innerText = state.currentTurn === playerRole ? "YOUR TURN" : "OPPONENT'S TURN";
      state.selectedNumbers?.forEach(n => {
        if (n !== 0) document.getElementById(`cell-${n}`)?.classList.add('crossed');
      });
      checkWinLogic(state.selectedNumbers || []);
    });
  }

  async function handleMove(num) {
    const snap = await get(ref(db, `rooms/${roomId}/gameState`));
    const state = snap.val();
    if (state.currentTurn === playerRole && !state.selectedNumbers.includes(num) && !state.winner) {
      await update(ref(db, `rooms/${roomId}/gameState`), {
        selectedNumbers: [...state.selectedNumbers, num],
        currentTurn: playerRole === "p1" ? "p2" : "p1"
      });
    }
  }

  // WIN LOGIC + GLOWING LINES
  function checkWinLogic(selected) {
    const hits = myBoard.map(n => selected.includes(n));
    let winCells = new Set();
    let lines = 0;

    for (let i = 0; i < 5; i++) {
      // Horizontal
      if ([0,1,2,3,4].every(j => hits[i*5+j])) { lines++; [0,1,2,3,4].forEach(j => winCells.add(i*5+j)); }
      // Vertical
      if ([0,5,10,15,20].every(j => hits[i+j])) { lines++; [0,5,10,15,20].forEach(j => winCells.add(i+j)); }
    }
    // Diagonals
    if ([0,6,12,18,24].every(i => hits[i])) { lines++; [0,6,12,18,24].forEach(i => winCells.add(i)); }
    if ([4,8,12,16,20].every(i => hits[i])) { lines++; [4,8,12,16,20].forEach(i => winCells.add(i)); }

    winCells.forEach(idx => document.getElementById(`cell-${myBoard[idx]}`).classList.add('winning-line'));
    if (lines >= 5) update(ref(db, `rooms/${roomId}/gameState`), { winner: playerRole });
  }

  // AUTO-CLICK & CLOSE CHAT
  const emojis = ['ğŸ”¥', 'ğŸ¯', 'ğŸ˜‚', 'ğŸ’€', 'ğŸ˜±', 'ğŸ‘', 'ğŸ‘‘', 'âš¡'];
  const emojiList = document.getElementById('emoji-list');
  const panel = document.getElementById('chat-panel');

  emojis.forEach(e => {
    const b = document.createElement('button');
    b.className = 'emoji-btn'; b.innerText = e;
    b.onclick = async () => {
      await push(ref(db, `rooms/${roomId}/chat`), { emoji: e, sender: playerRole });
      panel.classList.remove('open'); // AUTO-CLOSE
    };
    emojiList.appendChild(b);
  });

  document.getElementById('chat-fab').onclick = () => panel.classList.toggle('open');
  document.getElementById('close-chat').onclick = () => panel.classList.remove('open');

</script>
</body>
        </html>
  
